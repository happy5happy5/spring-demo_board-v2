<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/webjars/bootstrap/5.1.3/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <h1 class="my-4">Board Detail</h1>
    <table class="table">
        <tbody>
        <tr>
            <th scope="row">No</th>
            <td th:text="${no}"></td>
        </tr>
        <tr>
            <th scope="row">Title</th>
            <td th:text="${board.title}"></td>
        </tr>
        <tr>
            <th scope="row">Content</th>
            <td th:text="${board.content}"></td>
        </tr>
        <tr>
            <th scope="row">Writer</th>
            <td th:text="${board.writer}"></td>
        </tr>
        <tr>
            <th scope="row">Created Time</th>
            <td th:text="${board.created_Time}"></td>
        </tr>
        </tbody>
    </table>
    <div class="d-flex justify-content-end">
        <a th:href="@{/board/list}" class="btn btn-secondary me-2">Back to List</a>
        <button class="btn btn-danger me-2" data-bs-toggle="modal"  data-bs-target="#delete-modal">Delete</button>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#edit-modal">Edit</button>
    </div>

    <!-- Delete Modal -->
    <div th:replace="fragments/modal :: #delete-modal"></div>

    <!-- Edit Modal -->
    <div th:replace="fragments/modal :: #edit-modal"></div>
</div>

<script>
    function deleteBoard(button) {
        const password = document.getElementById("password-input-d").value;
        const boardId = button.getAttribute("data-board-id");
        const data = {password, boardId};
        const no=button.getAttribute("data-board-no");
        fetch("/board/delete", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        }).then((response) => {
            if (response.url.includes('/board/delete') && response.status === 200) {
                alert("Board Deleted");
            //     리스트로 이동
                window.location.href = "/board/list";
            } else {
                alert("Password is incorrect");
            }
        });
    }
    document.querySelector('#delete-form').addEventListener('submit', function(event) {
        event.preventDefault(); // 폼 제출 막기
        // 폼 제출에 대한 추가 로직 작성
    });
    document.querySelector('#edit-form').addEventListener('submit', function(event) {
        event.preventDefault(); // 폼 제출 막기
        // 폼 제출에 대한 추가 로직 작성
    });
    const titleInput = document.getElementById("title-input-e");
    const titleCounter = document.getElementById("title-counter");

    const contentInput = document.getElementById("content-input-e");
    const contentCounter = document.getElementById("content-counter");

    titleInput.addEventListener("input", () => {
        let title = titleInput.value;

        // 글자 수가 33자를 초과할 경우 잘라내기
        if (title.length > 33) {
            title = title.substring(0, 33);
            titleInput.value = title;
        }

        const titleLength = title.length;
        titleCounter.textContent = `${titleLength} / 33 characters`;
    });


    contentInput.addEventListener("input", () => {
        let content = contentInput.value;

        // 글자 수가 80자를 초과할 경우 잘라내기
        if (content.length > 80) {
            content = content.substring(0, 80);
            contentInput.value = content;
        }

        const contentLength = content.length;
        contentCounter.textContent = `${contentLength} / 80 characters`;

        if (contentLength > 80) {
            contentCounter.style.color = "red";
        } else {
            contentCounter.style.color = "";
        }
    });

    function editBoard(button) {
        const boardId = button.getAttribute("data-board-id");
        const password = document.getElementById("password-input-e").value;
        const newPassword = document.getElementById("new-password-input-e").value;
        const title = document.getElementById("title-input-e").value;
        const content = contentInput.value;
        const no = button.getAttribute("data-board-no");

        if (!password || !title || !content) {
            alert("Please fill in all required fields.");
            return;
        }

        if (title.length > 33) {
            alert("Title cannot exceed 33 characters.");
            return;
        }

        if (content.length > 80) {
            alert("Content cannot exceed 80 characters.");
            return;
        }

        const data = {
            boardId,
            password,
            newPassword,
            title,
            content,
        };

        fetch("/board/edit", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
        }).then((response) => {
            if (response.url.includes('/board/edit') && response.status === 200) {
                alert("Board Edited");
                window.location.href = "/board/detail?id=" + boardId + "&no=" + no;
            } else if (response.url.includes('/board/passwordError')) {
                alert("Password is incorrect");
            } else {
                alert("Something went wrong.");
            }
        });
    }
</script>

<script src="/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>